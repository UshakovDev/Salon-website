#!/bin/bash

# üîÑ –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./switch_mode.sh

echo "üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ Salon-website"
echo "=================================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
if grep -q "localhost 127.0.0.1" nginx/default.conf; then
    CURRENT_MODE="üè† –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (localhost:8080)"
else
    CURRENT_MODE="üîí –ü—Ä–æ–¥–∞–∫—à–µ–Ω (HTTPS)"
fi

echo "üìç –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: $CURRENT_MODE"
echo ""

echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:"
echo "1) üè† –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
echo "2) üîí –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Ä–µ–∂–∏–º —Å HTTPS"
echo "3) üìñ –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ HTTPS"
echo "4) ‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Ä–µ–∂–∏–º–µ"
echo "5) ‚ùå –í—ã—Ö–æ–¥"
echo ""

read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-5): " choice

case $choice in
    1)
        echo ""
        echo "üè† –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
        ./switch_to_development.sh
        ;;
    2)
        echo ""
        echo "üîí –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Ä–µ–∂–∏–º..."
        ./switch_to_production.sh
        ;;
    3)
        echo ""
        echo "üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ HTTPS:"
        echo "=================================="
        cat HTTPS_SETUP.md
        ;;
    4)
        echo ""
        echo "‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Ä–µ–∂–∏–º–µ:"
        echo "================================="
        echo "üìç –†–µ–∂–∏–º: $CURRENT_MODE"
        echo ""
        echo "üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–¥—Ä–µ—Å–∞:"
        if grep -q "localhost 127.0.0.1" nginx/default.conf; then
            echo "   - http://localhost:8080 (–æ—Å–Ω–æ–≤–Ω–æ–π)"
            echo "   - http://127.0.0.1:8080"
        else
            echo "   - https://queen-cosmo.ru (–æ—Å–Ω–æ–≤–Ω–æ–π)"
            echo "   - http://queen-cosmo.ru (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS)"
        fi
        echo ""
        echo "üîß –ü–æ—Ä—Ç Nginx:"
        if grep -q "8080:80" docker-compose.yml; then
            echo "   - 8080:80 (localhost —Ä–µ–∂–∏–º)"
        else
            echo "   - 80:80 –∏ 443:443 (–ø—Ä–æ–¥–∞–∫—à–µ–Ω —Ä–µ–∂–∏–º)"
        fi
        echo ""
        echo "üêç Django DEBUG:"
        if grep -q "DEBUG = True" django-backend/src/proj/settings.py; then
            echo "   - –í–∫–ª—é—á–µ–Ω (—Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)"
        else
            echo "   - –û—Ç–∫–ª—é—á–µ–Ω (–ø—Ä–æ–¥–∞–∫—à–µ–Ω —Ä–µ–∂–∏–º)"
        fi
        ;;
    5)
        echo "üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!"
        exit 0
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
        exit 1
        ;;
esac

echo ""
echo "‚úÖ –û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üîÑ –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:"
echo "   docker-compose down && docker-compose up -d"
