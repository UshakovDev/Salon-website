#!/bin/bash

echo "üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ Queen Cosmo"
echo "=============================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
if [ ! -f "docker-compose.yml" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

echo "üìã –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π..."
python3 generate_secrets.py

echo ""
echo "üìã –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."

# –°–æ–∑–¥–∞–µ–º locals_vars.py –∏–∑ —à–∞–±–ª–æ–Ω–∞
if [ ! -f "django-backend/src/proj/locals_vars.py" ]; then
    echo "   –°–æ–∑–¥–∞—é locals_vars.py –∏–∑ —à–∞–±–ª–æ–Ω–∞..."
    cp django-backend/src/proj/locals_vars.py.example django-backend/src/proj/locals_vars.py
    echo "   ‚ö†Ô∏è  –í–ê–ñ–ù–û: –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ locals_vars.py –∏ –∑–∞–º–µ–Ω–∏—Ç–µ placeholder'—ã!"
else
    echo "   ‚ö†Ô∏è  locals_vars.py —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ!"
fi

# –°–æ–∑–¥–∞–µ–º .pg-env –∏–∑ —à–∞–±–ª–æ–Ω–∞
if [ ! -f "postgresql-db/.pg-env" ]; then
    echo "   –°–æ–∑–¥–∞—é .pg-env –∏–∑ —à–∞–±–ª–æ–Ω–∞..."
    cp postgresql-db/.pg-env.example postgresql-db/.pg-env
    echo "   ‚ö†Ô∏è  –í–ê–ñ–ù–û: –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .pg-env –∏ –∑–∞–º–µ–Ω–∏—Ç–µ placeholder'—ã!"
else
    echo "   ‚ö†Ô∏è  .pg-env —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ!"
fi

echo ""
echo "üìã –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ .gitignore..."
if grep -q "locals_vars.py" .gitignore && grep -q ".pg-env" .gitignore; then
    echo "   ‚úÖ .gitignore –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ"
else
    echo "   ‚ùå .gitignore –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!"
fi

echo ""
echo "üìã –®–∞–≥ 4: –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ Git..."
echo "   –£–¥–∞–ª—è—é locals_vars.py –∏–∑ Git (—Ñ–∞–π–ª –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)..."
git rm --cached django-backend/src/proj/locals_vars.py 2>/dev/null || echo "   –§–∞–π–ª –Ω–µ –±—ã–ª –≤ Git"

echo "   –£–¥–∞–ª—è—é .pg-env –∏–∑ Git (—Ñ–∞–π–ª –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)..."
git rm --cached postgresql-db/.pg-env 2>/dev/null || echo "   –§–∞–π–ª –Ω–µ –±—ã–ª –≤ Git"

echo ""
echo "üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìù –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo "1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ django-backend/src/proj/locals_vars.py"
echo "2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ postgresql-db/.pg-env"
echo "3. –ó–∞–º–µ–Ω–∏—Ç–µ placeholder'—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è"
echo "4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã"
echo "5. –°–æ–∑–¥–∞–π—Ç–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Django"
echo ""
echo "‚ö†Ô∏è  –í–ê–ñ–ù–û: –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ Git!"
echo "   –û–Ω–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ .gitignore"
